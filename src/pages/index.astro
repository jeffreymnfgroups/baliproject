---
// src/pages/index.astro - Enhanced with SEO optimization for Bali Beach Sports & Recreation Facility
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.tsx';
import ProjectsList from '../components/ProjectsList.tsx';
import ProjectsSlideshow from '../components/Slideshow.tsx';
import { projects } from '../data/projects.js';
import type { ImageMetadata } from 'astro';

const currentPath = Astro.url.pathname;

// Enhanced SEO meta data for Bali Beach Sports & Recreation Facility
const seoData = {
  title: "Bali Beach Sports & Recreation Facility - Global Beach Sport & Wellness Tourism",
  description: "Bali Beach Sports & Recreation Facility - Bali's integrated arena for surf, play, recovery, and community. World-class sports technology with environmental responsibility, creating over 400 jobs while preserving Bali's natural beauty.",
  keywords: "Bali sports facility, beach sports tourism, URBNSURF Bali, FIVB beach volleyball, extreme sports Bali, wellness tourism, sustainable sports facility, Bali waterpark, surf machines Bali, digital sports hub, eco-accommodation Bali, sports tourism Indonesia",
  image: "/og-image.jpg" // You'll need to create this
};

// Group projects by category
const overviewProjects = projects.filter(p => p.location === 'Facility Overview');
const attractionProjects = projects.filter(p => p.location === 'Centrepiece Attraction');
const surfProjects = projects.filter(p => p.location === 'URBNSURF + Recreational Waves');
const sportsProjects = projects.filter(p => p.location === 'Multi-Sport Complex');
const wellnessProjects = projects.filter(p => p.location === 'Health & Wellness');

// Import slideshow images with better type handling
const slideshowImageModules = import.meta.glob<{ default: ImageMetadata }>('../assets/projects/slideshow/*.{webp,jpg,jpeg,png}', { eager: true });

// Format images for the slideshow component with proper typing
let formattedSlideshowImages: Array<{ src: string; alt: string }> = [];

try {
  formattedSlideshowImages = Object.entries(slideshowImageModules)
    .map(([path, module], index) => {
      if (module?.default) {
        return {
          src: module.default.src || module.default,
          alt: `Bali Beach Sports & Recreation Facility ${index + 1} - Global Beach Sport & Wellness Tourism`
        };
      }
      return null;
    })
    .filter((img): img is { src: string; alt: string } => img !== null)
    .slice(0, 10);
} catch (error) {
  console.warn('Failed to load slideshow images:', error);
}

// Fallback: If no slideshow images found, use project images
if (formattedSlideshowImages.length === 0) {
  formattedSlideshowImages = projects.slice(0, 5).map((project, index) => ({
    src: project.image.src,
    alt: `${project.name} - ${project.location} Bali Beach Sports & Recreation Facility`
  }));
}

// Structured data for the homepage
const homepageStructuredData = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": seoData.title,
  "description": seoData.description,
  "url": "https://www.balibeachsports.com/",
  "mainEntity": {
    "@type": "SportsActivityLocation",
    "name": "Bali Beach Sports & Recreation Facility",
    "description": "Integrated arena for surf, play, recovery, and community",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Bali",
      "addressCountry": "Indonesia"
    },
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "Sports and Recreation Facilities",
      "itemListElement": projects.map((project, index) => ({
        "@type": "Offer",
        "position": index + 1,
        "itemOffered": {
          "@type": "SportsActivityLocation",
          "name": project.name,
          "description": project.description,
          "location": {
            "@type": "Place",
            "name": "Bali, Indonesia"
          }
        }
      }))
    }
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://www.balibeachsports.com/"
      }
    ]
  }
};
---

<Layout 
  title={seoData.title}
  description={seoData.description}
  keywords={seoData.keywords}
  image={seoData.image}
  url="https://www.balibeachsports.com/"
  type="website"
>
  <!-- Structured Data for Homepage -->
  <script type="application/ld+json" set:html={JSON.stringify(homepageStructuredData)} />
  
  <Navigation currentPath={currentPath} client:load />
  
  <!-- Hero Section with SEO-optimized content -->
  <section class="w-full mt-10" aria-label="Bali Beach Sports & Recreation Facility">
    <ProjectsSlideshow 
      images={formattedSlideshowImages}
      autoPlayInterval={2000}
      showDots={true}
      showArrows={false}
      height="60vh"
      client:load 
    />
  </section>
  
  <!-- Hidden SEO content for search engines -->
  <div class="sr-only">
    <h1>Bali Beach Sports & Recreation Facility - Global Beach Sport & Wellness Tourism</h1>
    <p>
      Welcome to the future of global beach sport & wellness tourism. Bali's integrated arena for surf, play, recovery, and community. 
      This world-class facility combines cutting-edge sports technology with environmental responsibility, creating over 400 jobs while 
      preserving Bali's natural beauty through innovative sustainability practices.
    </p>
    <h2>Facility Zones and Features</h2>
    <ul>
      {projects.map(project => (
        <li>
          <strong>{project.name}</strong> - {project.headline}. {project.subheadline}
        </li>
      ))}
    </ul>
    <h3>Sustainability and Community Impact</h3>
    <p>
      Built for a sustainable tomorrow with ocean water use, solar energy, zero-carbon concrete, and local materials. 
      Over 400 jobs created with local training and community-led development.
    </p>
  </div>
  
  <!-- Main Projects Content -->
  <main class="pt-0" role="main" aria-label="Bali Beach Sports & Recreation Facility Zones">
    <ProjectsList 
      projects={projects}
      emaarProjects={overviewProjects}
      hmrProjects={attractionProjects}
      client:load 
    />
  </main>
</Layout>

<style>
  /* Screen reader only content for SEO */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Ensure smooth scrolling without conflicts */
  html {
    scroll-behavior: auto;
  }
  
  main {
    min-height: 100vh;
  }
  
  * {
    will-change: auto;
  }
  
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  .slideshow-container {
    contain: layout style paint;
  }
</style>

<script>
  // Prevent the main TypeScript animations from running on projects page
  if (typeof window !== 'undefined') {
    const existingHandlers = (window as any).__scrollHandlers || [];
    existingHandlers.forEach((handler: EventListener) => {
      window.removeEventListener('scroll', handler);
    });
    (window as any).__scrollHandlers = [];
    (window as any).__isProjectsPage = true;
  }
</script>