---
// src/pages/index.astro - Bali Beach Sports & Recreation Facility Landing Page
import Layout from '../layouts/Layout.astro';
import FacilityNavigation from '../components/FacilityNavigation.tsx';
import FacilitySectionsList from '../components/FacilitySectionsList.tsx';
import ProjectsSlideshow from '../components/Slideshow.tsx';
import { facilitySections } from '../data/facility-sections.js';
import type { ImageMetadata } from 'astro';

const currentPath = Astro.url.pathname;

// Enhanced SEO meta data for the facility
const seoData = {
  title: "Bali Beach Sports & Recreation Facility - Investment Opportunity in Global Beach Sport & Wellness Tourism",
  description: "Investment opportunity in Bali's revolutionary beach sports and recreation facility featuring world-class surf machines, waterpark, extreme sports, wellness centers, and sustainable eco-accommodation. A community-focused destination creating 400+ jobs with strong ROI potential.",
  keywords: "Bali beach sports, recreation facility, surf machines, waterpark, extreme sports, wellness center, sustainable tourism, community development, beach volleyball, eSports arena, spa recovery, eco accommodation",
  image: "/og-facility.jpg"
};

// Import slideshow images for facility sections
const slideshowImageModules = import.meta.glob<{ default: ImageMetadata }>('../assets/projects/slideshow/*.{webp,jpg,jpeg,png}', { eager: true });

// Format images for the slideshow component
let formattedSlideshowImages: Array<{ src: string; alt: string }> = [];

try {
  formattedSlideshowImages = Object.entries(slideshowImageModules)
    .map(([path, module], index) => {
      if (module?.default) {
        return {
          src: module.default.src || module.default,
          alt: `Bali Beach Sports Facility ${index + 1} - Revolutionary Sports & Wellness Destination`
        };
      }
      return null;
    })
    .filter((img): img is { src: string; alt: string } => img !== null)
    .slice(0, 10);
} catch (error) {
  console.warn('Failed to load slideshow images:', error);
}

// Fallback: If no slideshow images found, use facility section images
if (formattedSlideshowImages.length === 0) {
  formattedSlideshowImages = facilitySections.slice(0, 5).map((section, index) => ({
    src: section.image.src,
    alt: `${section.name} - Bali Beach Sports & Recreation Facility`
  }));
}

// Structured data for the facility
const facilityStructuredData = {
  "@context": "https://schema.org",
  "@type": "InvestmentOpportunity",
  "name": "Bali Beach Sports & Recreation Facility",
  "description": seoData.description,
  "url": "https://www.binyousufgroup.com/",
  "address": {
    "@type": "PostalAddress",
    "addressCountry": "Indonesia",
    "addressRegion": "Bali",
    "addressLocality": "Canggu"
  },
  "amenityFeature": facilitySections.map((section) => ({
    "@type": "LocationFeatureSpecification",
    "name": section.name,
    "value": section.headline
  })),
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": "Facility Features",
    "itemListElement": facilitySections.map((section, index) => ({
      "@type": "Offer",
      "position": index + 1,
      "itemOffered": {
        "@type": "Service",
        "name": section.name,
        "description": section.subheadline,
        "category": section.category
      }
    }))
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://www.balibeachsports.com/"
      }
    ]
  }
};
---

<Layout 
  title={seoData.title}
  description={seoData.description}
>
  <!-- Structured Data for Facility -->
  <script type="application/ld+json" set:html={JSON.stringify(facilityStructuredData)} />
  
  <FacilityNavigation currentPath={currentPath} client:load />
  
  <!-- Hero Section with Facility Slideshow -->
  <section class="w-full mt-10" aria-label="Bali Beach Sports & Recreation Facility Overview">
    <ProjectsSlideshow 
      images={formattedSlideshowImages}
      autoPlayInterval={3000}
      showDots={true}
      showArrows={false}
      height="60vh"
      client:load 
    />
  </section>
  
  <!-- Hidden SEO content for search engines -->
  <div class="sr-only">
    <h1>Bali Beach Sports & Recreation Facility - Revolutionary Sports & Wellness Destination</h1>
    <p>
      Experience the future of global beach sport and wellness tourism at Bali's most innovative 
      recreation facility. Featuring world-class surf machines, waterpark attractions, extreme sports zones, 
      wellness centers, and sustainable eco-accommodation, all designed to create over 400 local jobs 
      and serve as a community-focused destination.
    </p>
    <h2>Facility Features</h2>
    <ul>
      {facilitySections.map(section => (
        <li>
          <strong>{section.name}</strong> - {section.headline}: {section.subheadline}
        </li>
      ))}
    </ul>
    <h3>Sustainability and Community Impact</h3>
    <p>
      Built for a sustainable tomorrow with ocean water use, solar energy, zero-carbon concrete, and local materials. 
      Over 400 jobs created with local training and community-led development.
    </p>
  </div>
  
  <!-- Main Facility Content -->
  <main class="pt-0" role="main" aria-label="Bali Beach Sports & Recreation Facility Sections">
    <FacilitySectionsList 
      sections={facilitySections}
      client:load 
    />
  </main>
</Layout>

<style>
  /* Screen reader only content for SEO */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Ensure smooth scrolling without conflicts */
  html {
    scroll-behavior: auto;
  }
  
  main {
    min-height: 100vh;
  }
  
  * {
    will-change: auto;
  }
  
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  .slideshow-container {
    contain: layout style paint;
  }
</style>

<script>
  // Prevent conflicts with other page scripts
  if (typeof window !== 'undefined') {
    const existingHandlers = (window as any).__scrollHandlers || [];
    existingHandlers.forEach((handler: EventListener) => {
      window.removeEventListener('scroll', handler);
    });
    (window as any).__scrollHandlers = [];
    (window as any).__isFacilityPage = true;
  }
</script>